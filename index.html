<!DOCTYPE html><html lang="id"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flashcard Bahasa + TTS</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      min-height: 100vh;
      background-color: var(--bg); color: var(--text);
      transition: all 0.3s;
    }
    :root {
      --bg: #f4f4f4;
      --card: #fff;
      --text: #000;
      --border: #e5e5e5;
    }
    .dark {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f1f1f1;
      --border: #333;
    }
    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      width: 90%; max-width: 400px;
      text-align: center;
      min-height: 150px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    .controls, .menu {
      margin-top: 15px;
      display: flex; gap: 10px; flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 6px 12px;
      border: none; border-radius: 6px;
      cursor: pointer;
      background: #007bff; color: white;
      transition: background 0.2s;
    }
    button:hover {
      background: #0056b3;
    }
    select {
      padding: 5px; border-radius: 6px;
    }
    #donateFooter {
      position: fixed;
      bottom: 0; left: 0;
      width: 100%;
      background: var(--card);
      border-top: 1px solid var(--border);
      color: var(--text);
      font-size: 0.9rem;
      text-align: center;
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 999;
    }
    #donateFooter a {
      color: #f97316;
      font-weight: 600;
      text-decoration: none;
    }
    #donateFooter a:hover {
      text-decoration: underline;
    }
  </style>
<script src="https://puc.poecdn.net/authenticated_preview_page/syncedState.bd4eeeb8e8e02052ee92.js"></script></head>
<body>
  <h2>🌍 Flashcard Bahasa + TTS</h2>
  <div class="menu">
    <select id="deckSelect"></select>
    <button onclick="toggleTheme()">🌙/☀️</button>
    <button onclick="addDeck()">➕ Bahasa</button>
    <button onclick="deleteDeck()">🗑️ Bahasa</button>
    <button onclick="importJSON()">📂 Import</button>
    <button onclick="exportJSON()">💾 Export</button>
    <button onclick="resetData()">🔄 Reset Data</button>
  </div>

  <div class="card" onclick="toggleAnswer()">
    <span id="flashText">Pilih bahasa dulu</span>
  </div>

  <div class="controls">
    <button onclick="prevCard()">⬅️ Prev</button>
    <button onclick="nextCard()">Next ➡️</button>
    <button onclick="addCard()">➕ Tambah</button>
    <button onclick="deleteCard()">🗑️ Hapus</button>
    <button onclick="speak()">🔊 Speak</button>
    <button onclick="stopSpeak()">⏹ Stop</button>
  </div>

  <div class="controls">
    <span>Rate:</span>
    <button onclick="adjustRate(-0.1)">◀</button>
    <span id="rateVal">1.0</span>
    <button onclick="adjustRate(0.1)">▶</button>

    <span>Pitch:</span>
    <button onclick="adjustPitch(-0.1)">◀</button>
    <span id="pitchVal">1.0</span>
    <button onclick="adjustPitch(0.1)">▶</button>
  </div>

  <footer id="donateFooter">
    <span>Gratis untuk semua</span>
    <a href="https://saweria.co/valitio" target="_blank" rel="noopener noreferrer">
      💝 Dukung via Saweria
    </a>
  </footer>

  <script>
    // Data default (untuk reset)
    const defaultData = {
      "English": [
        {q: "Apple", a: "Apel"},
        {q: "School", a: "Sekolah"},
        {q: "I am happy", a: "Saya bahagia"},
        {q: "How are you today?", a: "Apa kabar hari ini?"},
        {q: "Could you please help me find the nearest bus station?", 
         a: "Bisakah kamu tolong saya menemukan halte bus terdekat?"},
        {q: "The weather is really nice today, I think we should go for a walk in the park.", 
         a: "Cuacanya benar-benar bagus hari ini, saya pikir kita sebaiknya jalan-jalan ke taman."},
        {q: "Learning English every day, even for just 15 minutes, can improve your skills significantly.", 
         a: "Belajar Bahasa Inggris setiap hari, bahkan hanya 15 menit, dapat meningkatkan kemampuanmu secara signifikan."}
      ]
    };

    // Local Storage Keys
    const STORAGE_KEY = "flashcards-bahasa-data";
    const THEME_KEY = "flashcards-bahasa-theme";

    let data = {};
    let deck = [], deckName = null, index = 0, showAnswer = false;
    let speechRate = 1.0;
    let speechPitch = 1.0;

    // --- Local Storage Data ---
    function loadData() {
      const saved = localStorage.getItem(STORAGE_KEY);
      if (saved) {
        try {
          data = JSON.parse(saved);
        } catch {
          data = JSON.parse(JSON.stringify(defaultData));
        }
      } else {
        data = JSON.parse(JSON.stringify(defaultData));
      }
    }

    function saveData() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    function loadTheme() {
      if (localStorage.getItem(THEME_KEY) === "dark") {
        document.body.classList.add("dark");
      }
    }

    function saveTheme() {
      if (document.body.classList.contains("dark")) {
        localStorage.setItem(THEME_KEY, "dark");
      } else {
        localStorage.setItem(THEME_KEY, "light");
      }
    }

    function init() {
      loadData();
      loadTheme();
      const sel = document.getElementById("deckSelect");
      sel.innerHTML = "<option disabled selected>Pilih Bahasa</option>";
      Object.keys(data).forEach(name => {
        const opt = document.createElement("option");
        opt.value = name; opt.textContent = name;
        sel.appendChild(opt);
      });
      sel.value = deckName || "Pilih Bahasa";
      sel.onchange = () => selectDeck(sel.value);
      // Jika deckName masih valid setelah reload, pilih deck tersebut
      if (deckName && data[deckName]) {
        selectDeck(deckName);
      } else {
        deckName = null;
        deck = [];
        index = 0;
        showAnswer = false;
        document.getElementById("flashText").textContent = "Pilih bahasa dulu";
      }
      // Set rate dan pitch UI
      document.getElementById("rateVal").textContent = speechRate.toFixed(1);
      document.getElementById("pitchVal").textContent = speechPitch.toFixed(1);
    }

    function selectDeck(name) {
      deckName = name;
      deck = data[name];
      index = 0; showAnswer = false;
      render();
    }

    function render() {
      if (!deckName || deck.length === 0) {
        document.getElementById("flashText").textContent = "Belum ada kartu di bahasa ini";
        return;
      }
      const card = deck[index];
      document.getElementById("flashText").textContent =
        showAnswer ? card.a : card.q;
    }

    function toggleAnswer() {
      if (!deckName) return;
      showAnswer = !showAnswer;
      render();
    }

    function nextCard() {
      if (!deckName || deck.length === 0) return;
      index = (index+1) % deck.length;
      showAnswer = false;
      render();
      stopSpeak();
    }

    function prevCard() {
      if (!deckName || deck.length === 0) return;
      index = (index-1+deck.length) % deck.length;
      showAnswer = false;
      render();
      stopSpeak();
    }

    function addCard() {
      if (!deckName) return alert("Pilih bahasa dulu!");
      const q = prompt("Masukkan kata/kalimat (Bahasa Asing):");
      const a = prompt("Masukkan terjemahan (Bahasa Indonesia):");
      if(q && a) {
        deck.push({q,a});
        saveData();
        render();
      }
    }

    function deleteCard() {
      if (!deckName || deck.length === 0) return;
      if(confirm("Hapus kartu ini?")) {
        deck.splice(index,1);
        index = Math.max(0, index-1);
        saveData();
        render();
      }
    }

    function addDeck() {
      const name = prompt("Masukkan nama bahasa baru (misalnya: Japanese):");
      if (!name) return;
      if (data[name]) {
        alert("Bahasa sudah ada!");
        return;
      }
      data[name] = [];
      saveData();
      init();
      alert("Bahasa '" + name + "' berhasil ditambahkan!");
    }

    function deleteDeck() {
      if (!deckName) return alert("Pilih bahasa dulu!");
      if (confirm("Hapus bahasa '" + deckName + "' beserta semua kartunya?")) {
        delete data[deckName];
        deckName = null;
        deck = [];
        saveData();
        init();
        document.getElementById("flashText").textContent = "Pilih bahasa dulu";
      }
    }

    function importJSON() {
      const fileInput = document.createElement("input");
      fileInput.type = "file"; fileInput.accept = "application/json";
      fileInput.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          try {
            data = JSON.parse(reader.result);
            saveData();
            init();
            alert("Import berhasil!");
          } catch {
            alert("File tidak valid!");
          }
        };
        reader.readAsText(file);
      };
      fileInput.click();
    }

    function exportJSON() {
      const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "flashcards_bahasa.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
      saveTheme();
    }

    function speak() {
      if (!deckName || deck.length === 0) return;
      stopSpeak();
      const text = showAnswer ? deck[index].a : deck[index].q;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = getLangCode(deckName, showAnswer);
      utter.rate = speechRate;
      utter.pitch = speechPitch;
      speechSynthesis.speak(utter);
    }

    function stopSpeak() {
      if (speechSynthesis.speaking) speechSynthesis.cancel();
    }

    function adjustRate(delta) {
      speechRate = Math.max(0.5, Math.min(2.0, speechRate + delta));
      document.getElementById("rateVal").textContent = speechRate.toFixed(1);
    }

    function adjustPitch(delta) {
      speechPitch = Math.max(0.5, Math.min(2.0, speechPitch + delta));
      document.getElementById("pitchVal").textContent = speechPitch.toFixed(1);
    }

    function resetData() {
      if (confirm("Yakin ingin reset data ke awal? Semua perubahan akan hilang!")) {
        data = JSON.parse(JSON.stringify(defaultData));
        saveData();
        deckName = null;
        deck = [];
        index = 0;
        showAnswer = false;
        init();
        document.getElementById("flashText").textContent = "Pilih bahasa dulu";
      }
    }

    // Deteksi bahasa otomatis berdasarkan nama deck (untuk TTS)
    function getLangCode(deckName, isAnswer) {
      if (deckName.toLowerCase().includes("english")) return isAnswer ? "id-ID" : "en-US";
      if (deckName.toLowerCase().includes("indonesia")) return isAnswer ? "en-US" : "id-ID";
      if (deckName.toLowerCase().includes("japan")) return isAnswer ? "id-ID" : "ja-JP";
      if (deckName.toLowerCase().includes("korea")) return isAnswer ? "id-ID" : "ko-KR";
      if (deckName.toLowerCase().includes("france") || deckName.toLowerCase().includes("french")) return isAnswer ? "id-ID" : "fr-FR";
      // Default
      return "en-US";
    }

    // --- Inisialisasi aplikasi
    init();

    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registered"))
        .catch(err => console.error("SW registration failed:", err));
    }
  </script>


</body></html>