<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flashcard Bahasa + TTS</title>
  <link rel="manifest" href="manifest.webmanifest">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      min-height: 100vh;
      background-color: var(--bg); color: var(--text);
      transition: all 0.3s;
    }
    :root {
      --bg: #f4f4f4;
      --card: #fff;
      --text: #000;
    }
    .dark {
      --bg: #121212;
      --card: #1e1e1e;
      --text: #f1f1f1;
    }
    .card {
      background: var(--card);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      width: 90%; max-width: 400px;
      text-align: center;
      min-height: 150px;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    .controls, .menu {
      margin-top: 15px;
      display: flex; gap: 10px; flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 6px 12px;
      border: none; border-radius: 6px;
      cursor: pointer;
      background: #007bff; color: white;
    }
    select {
      padding: 5px; border-radius: 6px;
    }
  </style>
</head>
<footer id="donateFooter">
  <span>Gratis untuk semua</span>
  <a href="https://saweria.co/valitio" target="_blank" rel="noopener noreferrer">
    💝 Dukung via Saweria
  </a>
</footer>

<style>
  #donateFooter {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    background: var(--card);
    border-top: 1px solid var(--border);
    color: var(--text);
    font-size: 0.9rem;
    text-align: center;
    padding: 10px;
    display: flex;
    justify-content: center;
    gap: 10px;
    z-index: 999;
  }
  #donateFooter a {
    color: #f97316;
    font-weight: 600;
    text-decoration: none;
  }
  #donateFooter a:hover {
    text-decoration: underline;
  }
</style>

<body>
  <h2>🌍 Flashcard Bahasa + TTS</h2>
  <div class="menu">
    <select id="deckSelect"></select>
    <button onclick="toggleTheme()">🌙/☀️</button>
    <button onclick="addDeck()">➕ Bahasa</button>
    <button onclick="deleteDeck()">🗑️ Bahasa</button>
    <button onclick="importJSON()">📂 Import</button>
    <button onclick="exportJSON()">💾 Export</button>
  </div>

  <div class="card" onclick="toggleAnswer()">
    <span id="flashText">Pilih bahasa dulu</span>
  </div>

  <div class="controls">
    <button onclick="prevCard()">⬅️ Prev</button>
    <button onclick="nextCard()">Next ➡️</button>
    <button onclick="addCard()">➕ Tambah</button>
    <button onclick="deleteCard()">🗑️ Hapus</button>
    <button onclick="speak()">🔊 Speak</button>
    <button onclick="stopSpeak()">⏹ Stop</button>
  </div>

  <div class="controls">
    <span>Rate:</span>
    <button onclick="adjustRate(-0.1)">◀</button>
    <span id="rateVal">1.0</span>
    <button onclick="adjustRate(0.1)">▶</button>

    <span>Pitch:</span>
    <button onclick="adjustPitch(-0.1)">◀</button>
    <span id="pitchVal">1.0</span>
    <button onclick="adjustPitch(0.1)">▶</button>
  </div>

  <script>
    let data = {
      "English": [
        {q: "Apple", a: "Apel"},
        {q: "School", a: "Sekolah"},
        {q: "I am happy", a: "Saya bahagia"},
        {q: "How are you today?", a: "Apa kabar hari ini?"},
        {q: "Could you please help me find the nearest bus station?", 
         a: "Bisakah kamu tolong saya menemukan halte bus terdekat?"},
        {q: "The weather is really nice today, I think we should go for a walk in the park.", 
         a: "Cuacanya benar-benar bagus hari ini, saya pikir kita sebaiknya jalan-jalan ke taman."},
        {q: "Learning English every day, even for just 15 minutes, can improve your skills significantly.", 
         a: "Belajar Bahasa Inggris setiap hari, bahkan hanya 15 menit, dapat meningkatkan kemampuanmu secara signifikan."}
      ]
    };

    let deck = [], deckName = null, index = 0, showAnswer = false;
    let speechRate = 1.0;
    let speechPitch = 1.0;

    function init() {
      const sel = document.getElementById("deckSelect");
      sel.innerHTML = "<option disabled selected>Pilih Bahasa</option>";
      Object.keys(data).forEach(name => {
        const opt = document.createElement("option");
        opt.value = name; opt.textContent = name;
        sel.appendChild(opt);
      });
      sel.onchange = () => selectDeck(sel.value);
    }

    function selectDeck(name) {
      deckName = name;
      deck = data[name];
      index = 0; showAnswer = false;
      render();
    }

    function render() {
      if (!deckName || deck.length === 0) {
        document.getElementById("flashText").textContent = "Belum ada kartu di bahasa ini";
        return;
      }
      const card = deck[index];
      document.getElementById("flashText").textContent =
        showAnswer ? card.a : card.q;
    }

    function toggleAnswer() {
      if (!deckName) return;
      showAnswer = !showAnswer;
      render();
    }

    function nextCard() {
      if (!deckName || deck.length === 0) return;
      index = (index+1) % deck.length;
      showAnswer = false;
      render();
      stopSpeak();
    }

    function prevCard() {
      if (!deckName || deck.length === 0) return;
      index = (index-1+deck.length) % deck.length;
      showAnswer = false;
      render();
      stopSpeak();
    }

    function addCard() {
      if (!deckName) return alert("Pilih bahasa dulu!");
      const q = prompt("Masukkan kata/kalimat (Bahasa Asing):");
      const a = prompt("Masukkan terjemahan (Bahasa Indonesia):");
      if(q && a) deck.push({q,a});
      render();
    }

    function deleteCard() {
      if (!deckName || deck.length === 0) return;
      if(confirm("Hapus kartu ini?")) {
        deck.splice(index,1);
        index = Math.max(0, index-1);
        render();
      }
    }

    function addDeck() {
      const name = prompt("Masukkan nama bahasa baru (misalnya: Japanese):");
      if (name && !data[name]) {
        data[name] = [];
        init();
        alert("Bahasa '" + name + "' berhasil ditambahkan!");
      } else if (data[name]) {
        alert("Bahasa sudah ada!");
      }
    }

    function deleteDeck() {
      if (!deckName) return alert("Pilih bahasa dulu!");
      if (confirm("Hapus bahasa '" + deckName + "' beserta semua kartunya?")) {
        delete data[deckName];
        deckName = null;
        deck = [];
        init();
        document.getElementById("flashText").textContent = "Pilih bahasa dulu";
      }
    }

    function importJSON() {
      const fileInput = document.createElement("input");
      fileInput.type = "file"; fileInput.accept = "application/json";
      fileInput.onchange = e => {
        const file = e.target.files[0];
        const reader = new FileReader();
        reader.onload = () => {
          try {
            data = JSON.parse(reader.result);
            init();
            alert("Import berhasil!");
          } catch {
            alert("File tidak valid!");
          }
        };
        reader.readAsText(file);
      };
      fileInput.click();
    }

    function exportJSON() {
      const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = "flashcards_bahasa.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    function speak() {
      if (!deckName || deck.length === 0) return;
      stopSpeak();
      const text = showAnswer ? deck[index].a : deck[index].q;
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = deckName === "English" ? "en-US" : "id-ID";
      utter.rate = speechRate;
      utter.pitch = speechPitch;
      speechSynthesis.speak(utter);
    }

    function stopSpeak() {
      if (speechSynthesis.speaking) speechSynthesis.cancel();
    }

    function adjustRate(delta) {
      speechRate = Math.max(0.5, Math.min(2.0, speechRate + delta));
      document.getElementById("rateVal").textContent = speechRate.toFixed(1);
    }

    function adjustPitch(delta) {
      speechPitch = Math.max(0.5, Math.min(2.0, speechPitch + delta));
      document.getElementById("pitchVal").textContent = speechPitch.toFixed(1);
    }

    init();
      if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker registered"))
        .catch(err => console.error("SW registration failed:", err));
    }
  </script>
</body>
</html>
